## 💻 前端页面功能、合约调用与设计细节

### 页面 A: 公共产品验证与查询 (Public Verification View)

**目标：** 提供产品的信任基础，允许任何访客验证产品身份、溯源和保修状态 。

| 编号 | 具体要实现的功能 | 调用的合约函数/机制 | 页面布局设计建议 |
| :--- | :--- | :--- | :--- |
| **1** | **产品查询入口** | `IProductRegistry.getTokenIdBySerialNumber()` | **顶部：** 居中设计一个突出的搜索框，提示输入“产品序列号”或“Token ID”。 |
| **2** | **产品静态详情展示** | `IProductRegistry.verifyProduct(tokenId)` | [cite_start]**核心信息卡片：** 展示产品型号 [cite: 21][cite_start]、制造商地址 [cite: 22]、当前所有者地址、首次注册日期等信息。 |
| **3** | **保修状态面板** | `IWarrantyManager.getWarrantyStatus(tokenId)` | [cite_start]**高亮面板：** 位于顶部，用颜色（绿色/红色）突出显示保修状态（有效/过期），并显示剩余天数和剩余索赔次数 [cite: 23]。 |
| **4** | **所有权历史追溯** | `IProductRegistry.verifyProduct(tokenId)` | [cite_start]**时间轴区域：** 以垂直或水平时间轴形式，按时间倒序展示 M→R→C→转售的每一次所有权转移记录 [cite: 23, 19]、转移类型和交易哈希。 |
| **5** | **服务记录公开展示** | `IWarrantyManager.getWarrantyStatus(tokenId)` | [cite_start]**列表/表格：** 展示所有已处理（批准/拒绝）的索赔记录。每条记录需包含：服务中心地址 [cite: 17]、处理状态、处理时间戳和**维修日志详情**。 |

**说明：** 2、3、4、5的信息均是在输入产品序列号信息后展示在页面的，是正在查询的这个产品对应的信息。
---

### 页面 B: 制造商仪表板 (Manufacturer Dashboard)

[cite_start]**目标：** 满足制造商职责：新品铸造、发行保修细节和直接分发给零售商 [cite: 14, 23]。

| 编号 | 具体要实现的功能 | 调用的合约函数/机制 | 页面布局设计建议 |
| :--- | :--- | :--- | :--- |
| **1** | **新品注册与分发表单** | `Marketplace.registerAndDistribute(...)` | [cite_start]**核心模块：** 占据页面主要部分。设计一个多字段表单，包含产品 ID [cite: 21][cite_start]、序列号 [cite: 21][cite_start]、型号 [cite: 21][cite_start]、价格、保修期（天数）、最大索赔次数 [cite: 25]，以及**目标零售商的钱包地址**。 |
| **2** | **分发执行按钮** | `Marketplace.registerAndDistribute(...)` | [cite_start]**醒目按钮：** 表单下方提供“**注册并分发给零售商**”按钮。点击后触发原子交易，完成铸造和所有权转移 [cite: 14]。 |
| **3** | **历史分发审计** | **链下索引 (Events)** | **下方表格：** 展示所有已完成分发的产品列表，用于内部审计和追踪。 |
| **4** | **钱包与权限状态** | `IRolesContract.isManufacturer(addr)` | **侧边栏/顶部：** 显示当前连接的钱包地址，以及“制造商角色：已授权”的状态。 |

---

### 页面 C: 零售商仪表板 (Retailer Dashboard)

[cite_start]**目标：** 满足零售商职责：将所有权转移给买家 [cite: 15]。

| 编号 | 具体要实现的功能 | 调用的合约函数/机制 | 页面布局设计建议 |
| :--- | :--- | :--- | :--- |
| **1** | **当前库存列表** | **链下索引 (Events)** | **左侧/顶部：** 主要展示零售商当前拥有的产品 NFT 列表，作为“待售库存”。列表应显示 `isListed` 状态。 |
| **2** | **产品上架与定价** | `Marketplace.listProductForSale(productId, price)` | **列表内嵌操作：** 在库存列表的每一项旁，提供“编辑价格”和“上架/下架”切换按钮，快速控制市场状态。 |
| **3** | **零售销售交付 (R → C)** | `Marketplace.retailSaleToCustomer(productId, customerAddress)` | **右侧“收银台”模块：** 1. **产品 ID 选择**（从库存中选择）。 2. **客户地址输入框：** 醒目标注“买方钱包地址”。 3. **交付按钮：** “**确认交付数字所有权**”。 |

---

### 页面 D: 客户仪表板 (Customer Dashboard)

[cite_start]**目标：** 满足客户职责：验证所有权 [cite: 16][cite_start]、请求保修服务 [cite: 16][cite_start]、转移所有权 (转售) [cite: 16]。

| 编号 | 具体要实现的功能 | 调用的合约函数/机制 | 页面布局设计建议 |
| :--- | :--- | :--- | :--- |
| **1** | **我的产品列表查看** | **链下索引 (Events)** | **卡片视图：** 核心区域展示客户拥有的产品卡片。每张卡片应显示型号、序列号、当前保修状态。 |
| **2** | **二手转售管理** | `Marketplace.customerResale(productId, newCustomer, newPrice, isListed)` | **卡片操作区：** 每个产品卡片下提供“设置转售价格”表单和“**上架/下架市场**”按钮（切换 `isListed` 状态）。 |
| **3** | **保修有效性校验** | `IWarrantyManager.isWarrantyValid(productId)` | [cite_start]**卡片操作区：** 针对保修有效的产品，提供“**发起索赔**”按钮。点击后弹出表单，让客户输入索赔描述(可选吧这一点，感觉不做也行) [cite: 25]。 |
| **4** | **索赔状态追踪** | `IWarrantyManager.getWarrantyStatus(tokenId)` | **下方列表/历史记录 Tab：** 展示客户所有已发起索赔的历史记录及其当前处理状态。 |

---

### 页面 E: 服务中心仪表板 (Service Center Dashboard)

[cite_start]**目标：** 满足服务中心职责：**验证保修索赔和记录服务操作** [cite: 17]。

| 编号 | 具体要实现的功能 | 调用的合约函数/机制 | 页面布局设计建议 |
| :--- | :--- | :--- | :--- |
| **1** | **待处理索赔列表加载** | **链下索引 (Events)** | **核心表格：** 默认展示所有状态为 `Pending` 的索赔请求。表格列出：Token ID、客户描述、请求时间。 |
| **2** | **批准索赔与日志记录** | `IWarrantyManager.approveClaim(tokenId, log)` | [cite_start]**列表操作：** 每条记录旁提供“批准”按钮。点击后弹出 Modal 窗口，要求服务中心输入**服务日志/维修内容** [cite: 26]。 |
| **3** | **拒绝索赔与原因记录** | `IWarrantyManager.rejectClaim(tokenId, reason)` | [cite_start]**列表操作：** 每条记录旁提供“拒绝”按钮。点击后弹出 Modal 窗口，要求输入**拒绝原因** [cite: 26]。 |
| **4** | **已完成服务历史** | **链下索引 (Events)** | **Tab 视图：** 切换到历史 Tab，查看所有已处理的记录。 |

---

---

### 页面 F: 公共市场列表 (Public Marketplace Listing)

**目标：** 统一展示所有待售商品，解决买家的**发现**需求。

| 编号 | 具体要实现的功能 | 调用的合约函数/机制 | 页面布局设计建议 |
| :--- | :--- | :--- | :--- |
| **1** | **统一待售列表聚合** | **链下索引 (Subgraph)** | **核心展示区：** 采用电商网站的网格/卡片布局，展示所有 `isListed=true` 的产品。 |
| **2** | **卖家类型区分** | **链下索引数据** | **标签：** 在每个产品卡片上，醒目标签区分卖家类型（例如：“零售商 - 全新”徽章 或 “二手 - 客户转售”徽章）。 |
| **3** | **筛选与排序** | **链下索引查询** | **左侧栏/顶部：** 提供按价格、型号、**卖家类型**等属性的筛选器和排序功能。 |
| **4** | **产品详情验证链接** | **前端路由跳转 (链接至 Page A)** | **按钮：** 每个卡片上都必须有一个“**验证详情**”按钮，让买家在购买前跳转到 Page A 确认溯源。 |
| **5** | **链下购买指引** | **前端 UI 逻辑 (不调用合约)** | **指引弹窗：** 点击“购买/联系卖家”按钮后，弹出一个 Modal 窗口，展示卖家的联系信息和**“请通过链下方式完成付款”**的明确提示。（其实这个地方就是做一个假功能，真正的交易还是通过零售商输入客户地址实现的） |


**所有用户（包括客户和零售商）都是通过输入序列号，由前端调用合约查询到对应的 Token ID，才能获取该产品的全部链上历史记录 。**